(self.webpackChunkline_listing_app=self.webpackChunkline_listing_app||[]).push([[2143],{9874:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Xe});var n=a(3135),i=a(8594),r=a(4479),l=a(6329),s=a(1006),o=a.n(s),d=a(3665),u=a.n(d),c=a(2085),p=a(1475),m=a(9551),g=a(2703),f=a(8107),v=a(9308),h=a(760),y=a(101),S=a(969),E=a(5215),w=a(1250),_=a(9647),z=a(1276),b=a(1949),C=a(2305),V=a(6206),D=a.n(V);const x="NORMAL",T={displayDensity:{defaultValue:"NORMAL",requestable:!1,savable:!0},fontSize:{defaultValue:x,requestable:!1,savable:!0},digitGroupSeparator:{defaultValue:"SPACE",requestable:!1,savable:!0},showHierarchy:{defaultValue:!1,requestable:!0,savable:!0}},N=e=>Object.entries(T).filter((e=>e[1].requestable)).reduce(((t,a)=>{let[n,i]=a;return void 0!==e[n]&&e[n]!==i.defaultValue&&(t[n]=e[n]),t}),{});var P=a(5633),I=a(9941),R=a.n(I),M=a(5133);new Set([M.P6,M.qI,M.xi,M.PH,M.M6]),new Set([M.zC]);const k="programStatus",W="eventStatus",L="createdBy",A="lastUpdatedBy",O="eventDate",q="enrollmentDate",U="incidentDate",Z="scheduledDate",F="lastUpdated",H=new Set([O,q,U,Z,F]);var $=a(4805),j=a(1517),Q=a(2644);const B="COMPLETED",G="EVENT",X="ENROLLMENT",K={[$.rx]:"ouname",[k]:"programstatus",[W]:"eventstatus",[L]:"createdbydisplayname",[A]:"lastupdatedbydisplayname",[O]:"eventdate",[q]:"enrollmentdate",[U]:"incidentdate",[Z]:"scheduleddate",[F]:"lastupdated"},Y=e=>{let{showHierarchy:t}=e;const a=Object.assign({},K);return t&&(a[$.rx]="ounamehierarchy"),a},J={[G]:O,[X]:q},ee=(e,t)=>{let{outputType:a,type:n}=t;return e.filter((e=>!["longitude","latitude"].includes(e.dimension))).map((e=>e.dimensionType===M.cl?{...e,dimensionType:M.P6}:e.dimension===$.vi&&n===Q.UU?{...e,dimension:J[a],dimensionType:M.KV}:e))},te=(Q.UU,Q.Zp,e=>{let{value:t,header:a={},visualization:n={}}=e;return[K.eventStatus,K.programStatus].includes(a.name)?{ACTIVE:f.Z.t("Active"),CANCELLED:f.Z.t("Cancelled"),[B]:f.Z.t("Completed"),SCHEDULE:f.Z.t("Scheduled")}[t]||t:[p.$d,p.Wt].includes(a.valueType)?t&&R()(t).format(a.name===K.lastUpdated||a.valueType===p.Wt?"yyyy-MM-DD hh:mm":"yyyy-MM-DD"):(null==a?void 0:a.valueType)===p.H?t&&R()(t).format("yyyy-MM-DD"):(0,P.Q)(t,a.valueType||p.kl,a.optionSet?{}:{digitGroupSeparator:n.digitGroupSeparator,skipRounding:!1})}),ae=function(){let{stageOffset:e,column:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";if(Number.isInteger(e)){let a;return 0===e?a=f.Z.t("most recent"):1===e?a=f.Z.t("oldest"):e>1?a=f.Z.t("oldest {{repeatEventIndex}}",{repeatEventIndex:"+"+(e-1)}):e<0&&(a=f.Z.t("most recent {{repeatEventIndex}}",{repeatEventIndex:e})),`${t} (${a})`}return t};var ne=a(625);const ie=e=>(0,ne.X)(e).some((e=>{let{dimensionType:t,dimension:a,items:n}=e;return(t===M.KV||H.has(a))&&Array.isArray(n)&&n.length>0})),re="Visualization_legendKeyScrollbox__xeUwY",le="Visualization_pluginContainer__oXPo4",se="Visualization_fetchContainer__80fuv",oe="Visualization_fetching__7HD9F",de="Visualization_fetchIndicator__I2E9y",ue="Visualization_visualizationContainer__05bND",ce="Visualization_noTimeDimensionWarning__FQgNa",pe="Visualization_stickyFooter__Dd34A",me="Visualization_footerCell__Fncu5",ge="Visualization_stickyNavigation__0J6KV",fe="Visualization_dataTable__5lDA5",ve="Visualization_headerCell__4qkrt",he="Visualization_dimensionModalHandler__yWmOU",ye="Visualization_fontSizeLarge__z2BH2",Se="Visualization_fontSizeNormal__jf7Sh",Ee="Visualization_fontSizeSmall__FfsnC",we="Visualization_sizeComfortable__Su+7Q",_e="Visualization_sizeNormal__gHiph",ze="Visualization_sizeCompact__8D9I5",be="Visualization_cell__6WA8H",Ce="Visualization_emptyCell__5ufEQ",Ve="Visualization_nowrap__L4Sfl",De="Visualization_undefinedCell__LHsvF";var xe=a(4579);const Te="NV",Ne=()=>({1:f.Z.t("Yes"),0:f.Z.t("No"),[Te]:f.Z.t("Not answered")}),Pe={[X]:"enrollments",[G]:"events"},Ie=[L,A],Re=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return"ND"===(null===(e=(t[a]||{})[n])||void 0===e?void 0:e.valueStatus)},Me=e=>{let{rowValue:t,header:a,metaDataItems:n,isUndefined:i}=e;switch(a.valueType){case p.zU:case p.mb:return i?"":Ne()[t||Te];default:var r,l;return t?a.optionSet?(null===(l=((e,t,a)=>{const n=null==a?void 0:a[e];var i;if(n)return a[null===(i=n.options.find((e=>e.code===t)))||void 0===i?void 0:i.uid]})(a.optionSet,t,n))||void 0===l?void 0:l.name)||t:(null===(r=n[t])||void 0===r?void 0:r.name)||t:t}},ke=e=>{const t={},a=e=>{const a=[];return e.forEach((e=>{const n=e.dimension;var i,r;(e=>H.has(e))(n)||n===W||n===k?null!==(i=e.items)&&void 0!==i&&i.length&&(t[n]=null===(r=e.items)||void 0===r?void 0:r.map((e=>e.id))):Ie.includes(n)||a.push(e)})),a},n=a(e[j.Aq]),i=a(e[j.dQ]),r=a(e[j.lT]),l=Y(N(e)),s=[...e[j.Aq],...e[j.dQ]].map((e=>{var t;let{dimension:a,programStage:n,repetition:i}=e;const r=null!=n&&n.id?`${n.id}.${a}`:l[a]||a;return null!=i&&null!==(t=i.indexes)&&void 0!==t&&t.length?i.indexes.map((e=>r.replace(/\./,`[${e}].`))):r}));return{adaptedVisualization:{[j.Aq]:n,[j.dQ]:i,[j.lT]:r},headers:s,parameters:t}},We=async e=>{let{analyticsEngine:t,visualization:a,pageSize:n,page:i,relativePeriodDate:r,sortField:l,sortDirection:s,displayProperty:o}=e;const{adaptedVisualization:d,headers:u,parameters:c}=ke(a);let p=(new t.request).fromVisualization(d).withParameters({headers:u,totalPages:!1,...a.outputType!==G?{rowContext:!0}:{},...c}).withProgram(a.program.id).withDisplayProperty(o.toUpperCase()).withOutputType(a.outputType).withPageSize(n).withPage(i).withIncludeMetadataDetails();var m;a.outputType!==X&&(p=p.withStage(null===(m=a.programStage)||void 0===m?void 0:m.id));if(r&&ie(a)&&(p=p.withRelativePeriodDate(r)),l)switch(s){case"asc":p=p.withAsc(l);break;case"desc":p=p.withDesc(l)}const g=(f=a.outputType,Pe[f]);var f;return await t[g].getQuery(p)},Le={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}},Ae=async e=>{let{legendSetIds:t,dataEngine:a}=e;if(!t.length)return[];const n=await(async e=>{let{dataEngine:t,ids:a}=e;return(await t.query({legendSets:Le},{variables:{ids:a}})).legendSets.legendSets})({dataEngine:a,ids:t});return n},Oe=e=>{let{visualization:t,filters:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:s,page:o,sortField:d,sortDirection:u}=e;const m=(0,n.bQ)(),[f]=(0,c.useState)((()=>xe.Z.getAnalytics(m))),v=(0,c.useRef)(!1),[h,y]=(0,c.useState)(!0),[S,E]=(0,c.useState)(!0),[w,_]=(0,c.useState)(void 0),[z,b]=(0,c.useState)(null),C=null==a?void 0:a.relativePeriodDate,V=(0,c.useCallback)((async()=>{try{var e,a,n,i;const c=await We({analyticsEngine:f,page:o,pageSize:s,relativePeriodDate:C,sortDirection:u,sortField:d,visualization:t,displayProperty:r}),h=(e=>e.headers.map(((t,a)=>{const n={...t,index:a},{dimensionId:i,programStageId:r}=(e=>{const[t,a]=e.split(".").reverse(),[n,i]=(a||"").split("[");return{dimensionId:t,programStageId:n,repetitionIndex:(null==i?void 0:i.length)&&i.substring(0,i.indexOf("]"))}})(t.name);return r&&e.headers.filter((e=>e.name.includes(i))).length>1&&(n.column+=` - ${e.metaData.items[r].name}`),n})))(c),S=((e,t)=>{const a=[];for(let n=0,i=e.rows.length;n<i;n++){const i=e.rows[n],r=[];for(let a=0,l=t.length;a<l;a++){const l=t[a],s=i[l.index];r.push(Me({rowValue:s,header:l,metaDataItems:e.metaData.items,isUndefined:Re(e.rowContext,n,a)}))}a.push(r)}return a})(c,h),w=(e=>e.rowContext)(c),z=c.metaData.pager,V=[],D=h.reduce(((e,t)=>{var a;return{...e,[t.name]:null===(a=c.metaData.items[t.name])||void 0===a?void 0:a.legendSet}}),{});(null===(e=t.legend)||void 0===e?void 0:e.strategy)===g.zv&&null!==(a=t.legend)&&void 0!==a&&null!==(n=a.set)&&void 0!==n&&n.id?V.push(t.legend.set.id):(null===(i=t.legend)||void 0===i?void 0:i.strategy)===g.EE&&Object.values(D).filter((e=>e)).forEach((e=>V.push(e)));const x=await Ae({legendSetIds:V,dataEngine:m});x.length&&h.filter((e=>{return t=e.valueType,[p.FV,p.SA,p.y3,p.$r,p.VX,p.M7,p.iq].includes(t);var t})).forEach((e=>{switch(t.legend.strategy){case g.zv:e.legendSet=x[0];break;case g.EE:e.legendSet=x.find((t=>t.id===D[e.name]))}})),v.current&&_(void 0),v.current&&b({headers:h,rows:S,pager:z,rowContext:w}),l(c)}catch(e){v.current&&_(e)}finally{v.current&&y(!1),v.current&&E(!1)}}),[f,o,s,C,u,d,t]);return(0,c.useEffect)((()=>(v.current=!0,()=>{v.current=!1})),[]),(0,c.useEffect)((()=>{E(!0),V()}),[t,o,s,d,u,C]),(0,c.useEffect)((()=>{i&&(E(!1),y(!1),_(void 0),b(null))}),[i]),{loading:h,fetching:S,error:w,data:z,isGlobalLoading:i}};function qe(){return qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},qe.apply(this,arguments)}const Ue=(e,t)=>{if(e){var a,n;return`calc(100vh - ${285+(null!==(a=null==t||null===(n=t.current)||void 0===n?void 0:n.clientHeight)&&void 0!==a?a:0)}px)`}return"100%"},Ze=e=>{let{offline:t,...a}=e;return t?c.createElement(v.u,{content:f.Z.t("Not available offline")},c.createElement(h.t,a)):c.createElement(h.t,a)};Ze.propTypes={offline:u().bool};const Fe=e=>{let{filters:t,visualization:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,onColumnHeaderClick:s,onError:o}=e;const d=(0,c.useRef)(null),u=(0,c.useRef)(null),[h,V]=(0,c.useState)([]),[x,T]=(0,c.useState)({paginationMaxWidth:0,noticeBoxMaxWidth:0}),[{sortField:P,sortDirection:I,pageSize:R,page:M},k]=(0,c.useReducer)(((e,t)=>({...e,...t})),{sortField:null,sortDirection:"asc",page:1,pageSize:100}),L=(0,c.useMemo)((()=>a&&(e=>{const t=ee(e[j.Aq],e),a=ee(e[j.dQ],e),n=ee(e[j.lT],e);e.completedOnly&&e.outputType===G&&n.push({dimension:W,items:[{id:B}]});const i={...e};return delete i.completedOnly,{...i,[j.Aq]:t,[j.dQ]:a,[j.lT]:n}})(a)),[a]),A=!(null==t||!t.relativePeriodDate),O=(0,c.useMemo)((()=>ie(L)),[L]),q=A&&!O,U=(0,c.useRef)(L),Z=(0,c.useRef)(null),F=(0,c.useCallback)((e=>{if(null===e)return;const t=()=>{var t;if(0===e.clientWidth)return;const a=e.clientWidth,n=e.querySelector(".tablescrollbox"),i=n.offsetWidth-n.clientWidth,r=(null===(t=Z.current)||void 0===t?void 0:t.offsetWidth)>0?Z.current.offsetWidth+4:0,l=Math.max(a-i-r,250);T({paginationMaxWidth:l,noticeBoxMaxWidth:n.offsetWidth})},a=new window.ResizeObserver(t);return a.observe(e),t(),a.disconnect}),[]),H=(0,c.useCallback)((e=>k({page:e})),[]),{isDisconnected:$}=(0,n.Uw)(),{headers:Q}=ke(L);Q&&P&&(Q.includes(P)||k({sortField:null,sortDirection:"asc"}));const{fetching:X,error:K,data:J}=Oe({filters:t,visualization:L,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:R,page:L!==U.current?1:M,sortField:P,sortDirection:I}),ne=(0,c.useRef)(null),xe=(0,c.useRef)(null),Te=(0,c.useRef)(null),Ne=(0,c.useMemo)((()=>{if(!(X&&null!=ne&&ne.current&&null!=xe&&xe.current&&null!=Te&&Te.current))return"calc(50% - 12px)";const e=ne.current.clientHeight,t=xe.current.offsetHeight,a=e-t-Te.current.offsetHeight;return`${Math.round(t+a/2-12)}px`}),[X]);if((0,c.useEffect)((()=>{U.current=L,H(1)}),[L,H]),(0,c.useEffect)((()=>{if(J&&L){var e;const t=J.headers.filter((e=>e.legendSet)).map((e=>e.legendSet)),a=t.filter(((e,a)=>{var n;return t.findIndex((t=>t.id===e.id))===a&&(null===(n=e.legends)||void 0===n?void 0:n.length)}));a.length&&null!==(e=L.legend)&&void 0!==e&&e.showKey?V(a):V([])}else V([])}),[J,L]),(0,c.useEffect)((()=>{K&&o&&o(K)}),[K,o]),!J||K)return null;const Pe=(e=>{switch(e){case"COMFORTABLE":return we;case"COMPACT":return ze;default:return _e}})(L.displayDensity),Ie=(e=>{switch(e){case"LARGE":return ye;case"SMALL":return Ee;default:return Se}})(L.fontSize),Me=String(Math.max(J.headers.length,1)),We=e=>{let{name:t,direction:a}=e;return k({sortField:t,sortDirection:a,page:1})},Le=Y(N(L)),Ae=e=>{const t=ae(e),a=Number.isInteger(e.stageOffset)?e.name.replace(/\[-?\d+\]/,""):e.name;return c.createElement("span",{className:D()(ve,he),onClick:s?()=>s((e=>Object.keys(Le).find((t=>Le[t]===e)))(a)||a):void 0},t)},Fe=e=>{var t,a;let{columnIndex:n,value:i,isUndefined:r,props:l}=e;return c.createElement(y.W,qe({},l,{key:n,className:D()(be,Ie,Pe,{[Ce]:!i,[Ve]:(s=J.headers[n],[p.FV,p.$r,p.VX,p.M7,p.iq,p.y3,p.SA,p.zf,p.$d,p.Wt,p.so].includes(s.valueType)&&!s.optionSet),[De]:r},"bordered"),backgroundColor:(null===(t=L.legend)||void 0===t?void 0:t.style)===g.UJ?(0,g.i3)(J.headers[n].legendSet,i):void 0,dataTest:"table-cell"}),c.createElement("div",{style:(null===(a=L.legend)||void 0===a?void 0:a.style)===g.Xr?{color:(0,g.i3)(J.headers[n].legendSet,i)}:{}},((e,t)=>(null==t?void 0:t.valueType)===p.Xw?c.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},e):te({value:e,header:t,visualization:L}))(i,J.headers[n])));var s};return c.createElement("div",{className:le,ref:F},c.createElement("div",{"data-test":"line-list-fetch-container",className:D()(se,{[oe]:X}),ref:ne},c.createElement("div",{className:de,style:{top:Ne}}),c.createElement("div",{className:ue},q&&c.createElement("div",{className:ce,ref:d,style:{maxWidth:x.noticeBoxMaxWidth}},c.createElement(S.f,{warning:!0},f.Z.t("This line list may show data that was not available when the interpretation was written."))),c.createElement(E.w,{scrollHeight:Ue(A,d),scrollWidth:"100%",width:"auto",className:fe,dataTest:"line-list-table",ref:u},c.createElement(w.s,{ref:xe},c.createElement(_.U,null,J.headers.map(((e,t)=>e?c.createElement(z.p,{fixed:!0,top:"0",key:e.name,name:e.name,onSortIconClick:We,sortDirection:$?void 0:e.name===P?I:"default",sortIconTitle:f.Z.t("Sort by {{column}}",{column:ae(e)}),className:D()(ve,Ie,Pe,"bordered"),dataTest:"table-header"},Ae(e)):c.createElement(z.p,{fixed:!0,top:"0",key:`undefined_${t}`,className:D()(ve,Ie,Pe),dataTest:"table-header"}))))),c.createElement(b.R,{dataTest:"table-body"},J.rows.map(((e,t)=>c.createElement(_.U,{key:t,dataTest:"table-row"},e.map(((e,a)=>Re(J.rowContext,t,a)?c.createElement(v.u,{content:f.Z.t("No event")},(t=>Fe({columnIndex:a,value:e,isUndefined:!0,props:t}))):Fe({columnIndex:a,value:e}))))))),c.createElement(C.j,{className:pe,ref:Te},c.createElement(_.U,null,c.createElement(y.W,{colSpan:Me,staticStyle:!0,className:me},c.createElement("div",{className:D()(ge,Pe),style:{maxWidth:x.paginationMaxWidth,minWidth:250}},c.createElement(Ze,{offline:$,disabled:$||X,page:J.pager.page,pageSize:J.pager.pageSize||100,isLastPage:J.pager.isLastPage,onPageChange:H,onPageSizeChange:e=>k({pageSize:e,page:1}),pageSizeSelectText:f.Z.t("Rows per page"),pageLength:J.rows.length,pageSummaryText:e=>{let{firstItem:t,lastItem:a,page:n}=e;return f.Z.t("Page {{page}}, row {{firstItem}}-{{lastItem}}",{firstItem:t,lastItem:a,page:n})}}))))))),Boolean(h.length)&&c.createElement("div",{className:re,"data-test":"visualization-legend-key",ref:Z},c.createElement(m.Z,{legendSets:h}))))};Fe.defaultProps={displayProperty:"name",isVisualizationLoading:!1,onResponsesReceived:Function.prototype},Fe.propTypes={displayProperty:u().string.isRequired,isVisualizationLoading:u().bool.isRequired,visualization:u().object.isRequired,onResponsesReceived:u().func.isRequired,filters:u().object,onColumnHeaderClick:u().func,onError:u().func};const He="READY",$e="INSTALLING";function je(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(He)}}const Qe=()=>c.createElement(i.m,null,c.createElement(r.M,null,c.createElement(l.V,null))),Be=e=>{let{id:t,children:a,cacheNow:i,isParentCached:r}=e;const{startRecording:l,isCached:s,remove:d}=(0,n.Of)(t);return(0,c.useEffect)((()=>{i&&l({onError:console.error})}),[i]),(0,c.useEffect)((()=>{const e=o().on("removeCachedData",{window:window.parent},(()=>d()));return()=>e.cancel()}),[d]),(0,c.useEffect)((()=>{!r&&s&&d()}),[r]),c.createElement(n.MW,{id:t,loadingMask:Qe},a)};Be.propTypes={cacheNow:u().bool,children:u().node,id:u().string,isParentCached:u().bool};const Ge=e=>{o().send(window.parent,"installationStatus",{installationStatus:e})},Xe=()=>{const[e,t]=(0,c.useState)(),a=e=>t(e.data);return(0,c.useEffect)((()=>{o().send(window.parent,"getProps").then(a).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?He:a.installing?(je({installingWorker:a.installing,onStateChange:t}),$e):(a.onupdatefound=()=>{t($e);const e=a.installing;e&&je({installingWorker:e,onStateChange:t})},null):null}({onStateChange:Ge}).then(Ge);const e=o().on("newProps",{window:window.parent},a);return()=>e.cancel()}),[]),e?c.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},c.createElement(Be,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},c.createElement(Fe,e))):null}},2480:()=>{}}]);