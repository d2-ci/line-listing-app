(self.webpackChunkline_listing_app=self.webpackChunkline_listing_app||[]).push([[2143],{9874:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>je});var n=a(3135),i=a(8594),r=a(4479),l=a(6329),s=a(1006),o=a.n(s),d=a(3665),u=a.n(d),c=a(2085),p=a(1475),m=a(9551),g=a(2703),f=a(8107),h=a(9308),v=a(760),y=a(969),S=a(5215),E=a(1250),w=a(9647),_=a(1276),z=a(1949),b=a(101),V=a(2305),C=a(6206),D=a.n(C);const T="NORMAL",x={displayDensity:{defaultValue:"NORMAL",requestable:!1,savable:!0},fontSize:{defaultValue:T,requestable:!1,savable:!0},digitGroupSeparator:{defaultValue:"SPACE",requestable:!1,savable:!0},showHierarchy:{defaultValue:!1,requestable:!0,savable:!0}},N=e=>Object.entries(x).filter((e=>e[1].requestable)).reduce(((t,a)=>{let[n,i]=a;return void 0!==e[n]&&e[n]!==i.defaultValue&&(t[n]=e[n]),t}),{});var P=a(5633),R=a(9941),M=a.n(R),k=a(5133);new Set([k.P6,k.qI,k.xi,k.PH,k.M6]),new Set([k.zC]);const I="programStatus",W="eventStatus",A="createdBy",L="lastUpdatedBy",q="eventDate",O="enrollmentDate",Z="incidentDate",F="scheduledDate",H="lastUpdated",U=new Set([q,O,Z,F,H]);var $=a(4805),Q=a(1517),j=a(2644);const B="COMPLETED",G="EVENT",X="ENROLLMENT",K={[$.rx]:"ouname",[I]:"programstatus",[W]:"eventstatus",[A]:"createdbydisplayname",[L]:"lastupdatedbydisplayname",[q]:"eventdate",[O]:"enrollmentdate",[Z]:"incidentdate",[F]:"scheduleddate",[H]:"lastupdated"},Y=e=>{let{showHierarchy:t}=e;const a=Object.assign({},K);return t&&(a[$.rx]="ounamehierarchy"),a},J={[G]:q,[X]:O},ee=(e,t)=>{let{outputType:a,type:n}=t;return e.filter((e=>!["longitude","latitude"].includes(e.dimension))).map((e=>e.dimensionType===k.cl?{...e,dimensionType:k.P6}:e.dimension===$.vi&&n===j.UU?{...e,dimension:J[a],dimensionType:k.KV}:e))},te=(j.UU,j.Zp,e=>{let{value:t,header:a={},visualization:n={}}=e;return[K.eventStatus,K.programStatus].includes(a.name)?{ACTIVE:f.Z.t("Active"),CANCELLED:f.Z.t("Cancelled"),[B]:f.Z.t("Completed"),SCHEDULE:f.Z.t("Scheduled")}[t]||t:[p.$d,p.Wt].includes(a.valueType)?t&&M()(t).format(a.name===K.lastUpdated||a.valueType===p.Wt?"yyyy-MM-DD hh:mm":"yyyy-MM-DD"):(null==a?void 0:a.valueType)===p.H?t&&M()(t).format("yyyy-MM-DD"):(0,P.Q)(t,a.valueType||p.kl,a.optionSet?{}:{digitGroupSeparator:n.digitGroupSeparator,skipRounding:!1})}),ae=function(){let{stageOffset:e,column:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";if(Number.isInteger(e)){let a;return 0===e?a=f.Z.t("most recent"):1===e?a=f.Z.t("oldest"):e>1?a=f.Z.t("oldest {{repeatEventIndex}}",{repeatEventIndex:"+"+(e-1)}):e<0&&(a=f.Z.t("most recent {{repeatEventIndex}}",{repeatEventIndex:e})),`${t} (${a})`}return t};var ne=a(625);const ie=e=>(0,ne.X)(e).some((e=>{let{dimensionType:t,dimension:a,items:n}=e;return(t===k.KV||U.has(a))&&Array.isArray(n)&&n.length>0})),re="Visualization_legendKeyScrollbox__xeUwY",le="Visualization_pluginContainer__oXPo4",se="Visualization_fetchContainer__80fuv",oe="Visualization_fetching__7HD9F",de="Visualization_fetchIndicator__I2E9y",ue="Visualization_visualizationContainer__05bND",ce="Visualization_noTimeDimensionWarning__FQgNa",pe="Visualization_stickyFooter__Dd34A",me="Visualization_footerCell__Fncu5",ge="Visualization_stickyNavigation__0J6KV",fe="Visualization_dataTable__5lDA5",he="Visualization_headerCell__4qkrt",ve="Visualization_dimensionModalHandler__yWmOU",ye="Visualization_fontSizeLarge__z2BH2",Se="Visualization_fontSizeNormal__jf7Sh",Ee="Visualization_fontSizeSmall__FfsnC",we="Visualization_sizeComfortable__Su+7Q",_e="Visualization_sizeNormal__gHiph",ze="Visualization_sizeCompact__8D9I5",be="Visualization_cell__6WA8H",Ve="Visualization_emptyCell__5ufEQ",Ce="Visualization_nowrap__L4Sfl";var De=a(4579);const Te="NV",xe=()=>({1:f.Z.t("Yes"),0:f.Z.t("No"),[Te]:f.Z.t("Not answered")}),Ne={[X]:"enrollments",[G]:"events"},Pe=[A,L],Re=(e,t,a)=>{switch(t.valueType){case p.zU:case p.mb:return xe()[e||Te];default:var n,i;return e?t.optionSet?(null===(i=((e,t,a)=>{const n=null==a?void 0:a[e];var i;if(n)return a[null===(i=n.options.find((e=>e.code===t)))||void 0===i?void 0:i.uid]})(t.optionSet,e,a))||void 0===i?void 0:i.name)||e:(null===(n=a[e])||void 0===n?void 0:n.name)||e:e}},Me=e=>{const t={},a=e=>{const a=[];return e.forEach((e=>{const n=e.dimension;var i,r;(e=>U.has(e))(n)||n===W||n===I?null!==(i=e.items)&&void 0!==i&&i.length&&(t[n]=null===(r=e.items)||void 0===r?void 0:r.map((e=>e.id))):Pe.includes(n)||a.push(e)})),a},n=a(e[Q.Aq]),i=a(e[Q.dQ]),r=a(e[Q.lT]),l=Y(N(e)),s=[...e[Q.Aq],...e[Q.dQ]].map((e=>{var t;let{dimension:a,programStage:n,repetition:i}=e;const r=null!=n&&n.id?`${n.id}.${a}`:l[a]||a;return null!=i&&null!==(t=i.indexes)&&void 0!==t&&t.length?i.indexes.map((e=>r.replace(/\./,`[${e}].`))):r}));return{adaptedVisualization:{[Q.Aq]:n,[Q.dQ]:i,[Q.lT]:r},headers:s,parameters:t}},ke=async e=>{let{analyticsEngine:t,visualization:a,pageSize:n,page:i,relativePeriodDate:r,sortField:l,sortDirection:s,displayProperty:o}=e;const{adaptedVisualization:d,headers:u,parameters:c}=Me(a);let p=(new t.request).fromVisualization(d).withParameters({headers:u,totalPages:!1,...c}).withProgram(a.program.id).withDisplayProperty(o.toUpperCase()).withOutputType(a.outputType).withPageSize(n).withPage(i).withIncludeMetadataDetails();var m;a.outputType!==X&&(p=p.withStage(null===(m=a.programStage)||void 0===m?void 0:m.id));if(r&&ie(a)&&(p=p.withRelativePeriodDate(r)),l)switch(s){case"asc":p=p.withAsc(l);break;case"desc":p=p.withDesc(l)}const g=(f=a.outputType,Ne[f]);var f;return await t[g].getQuery(p)},Ie={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}},We=async e=>{let{legendSetIds:t,dataEngine:a}=e;if(!t.length)return[];const n=await(async e=>{let{dataEngine:t,ids:a}=e;return(await t.query({legendSets:Ie},{variables:{ids:a}})).legendSets.legendSets})({dataEngine:a,ids:t});return n},Ae=e=>{let{visualization:t,filters:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:s,page:o,sortField:d,sortDirection:u}=e;const m=(0,n.bQ)(),[f]=(0,c.useState)((()=>De.Z.getAnalytics(m))),h=(0,c.useRef)(!1),[v,y]=(0,c.useState)(!0),[S,E]=(0,c.useState)(!0),[w,_]=(0,c.useState)(void 0),[z,b]=(0,c.useState)(null),V=null==a?void 0:a.relativePeriodDate,C=(0,c.useCallback)((async()=>{try{var e,a,n,i;const c=await ke({analyticsEngine:f,page:o,pageSize:s,relativePeriodDate:V,sortDirection:u,sortField:d,visualization:t,displayProperty:r}),v=(e=>e.headers.map(((t,a)=>{const n={...t,index:a},{dimensionId:i,programStageId:r}=(e=>{const[t,a]=e.split(".").reverse(),[n,i]=(a||"").split("[");return{dimensionId:t,programStageId:n,repetitionIndex:(null==i?void 0:i.length)&&i.substring(0,i.indexOf("]"))}})(t.name);return r&&e.headers.filter((e=>e.name.includes(i))).length>1&&(n.column+=` - ${e.metaData.items[r].name}`),n})))(c),S=((e,t)=>{const a=[];for(let n=0,i=e.rows.length;n<i;n++){const i=e.rows[n],r=[];for(let a=0,n=t.length;a<n;a++){const n=t[a],l=i[n.index];r.push(Re(l,n,e.metaData.items))}a.push(r)}return a})(c,v),w=c.metaData.pager,z=[],C=v.reduce(((e,t)=>{var a;return{...e,[t.name]:null===(a=c.metaData.items[t.name])||void 0===a?void 0:a.legendSet}}),{});(null===(e=t.legend)||void 0===e?void 0:e.strategy)===g.zv&&null!==(a=t.legend)&&void 0!==a&&null!==(n=a.set)&&void 0!==n&&n.id?z.push(t.legend.set.id):(null===(i=t.legend)||void 0===i?void 0:i.strategy)===g.EE&&Object.values(C).filter((e=>e)).forEach((e=>z.push(e)));const D=await We({legendSetIds:z,dataEngine:m});D.length&&v.filter((e=>{return t=e.valueType,[p.FV,p.SA,p.y3,p.$r,p.VX,p.M7,p.iq].includes(t);var t})).forEach((e=>{switch(t.legend.strategy){case g.zv:e.legendSet=D[0];break;case g.EE:e.legendSet=D.find((t=>t.id===C[e.name]))}})),h.current&&_(void 0),h.current&&b({headers:v,rows:S,pager:w}),l(c)}catch(e){h.current&&_(e)}finally{h.current&&y(!1),h.current&&E(!1)}}),[f,o,s,V,u,d,t]);return(0,c.useEffect)((()=>(h.current=!0,()=>{h.current=!1})),[]),(0,c.useEffect)((()=>{E(!0),C()}),[t,o,s,d,u,V]),(0,c.useEffect)((()=>{i&&(E(!1),y(!1),_(void 0),b(null))}),[i]),{loading:v,fetching:S,error:w,data:z,isGlobalLoading:i}},Le=(e,t)=>{if(e){var a,n;return`calc(100vh - ${285+(null!==(a=null==t||null===(n=t.current)||void 0===n?void 0:n.clientHeight)&&void 0!==a?a:0)}px)`}return"100%"},qe=e=>{let{offline:t,...a}=e;return t?c.createElement(h.u,{content:f.Z.t("Not available offline")},c.createElement(v.t,a)):c.createElement(v.t,a)};qe.propTypes={offline:u().bool};const Oe=e=>{let{filters:t,visualization:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,onColumnHeaderClick:s,onError:o}=e;const d=(0,c.useRef)(null),u=(0,c.useRef)(null),[h,v]=(0,c.useState)([]),[C,T]=(0,c.useState)({paginationMaxWidth:0,noticeBoxMaxWidth:0}),[{sortField:x,sortDirection:P,pageSize:R,page:M},k]=(0,c.useReducer)(((e,t)=>({...e,...t})),{sortField:null,sortDirection:"asc",page:1,pageSize:100}),I=(0,c.useMemo)((()=>a&&(e=>{const t=ee(e[Q.Aq],e),a=ee(e[Q.dQ],e),n=ee(e[Q.lT],e);e.completedOnly&&e.outputType===G&&n.push({dimension:W,items:[{id:B}]});const i={...e};return delete i.completedOnly,{...i,[Q.Aq]:t,[Q.dQ]:a,[Q.lT]:n}})(a)),[a]),A=!(null==t||!t.relativePeriodDate),L=(0,c.useMemo)((()=>ie(I)),[I]),q=A&&!L,O=(0,c.useRef)(I),Z=(0,c.useRef)(null),F=(0,c.useCallback)((e=>{if(null===e)return;const t=()=>{var t;if(0===e.clientWidth)return;const a=e.clientWidth,n=e.querySelector(".tablescrollbox"),i=n.offsetWidth-n.clientWidth,r=(null===(t=Z.current)||void 0===t?void 0:t.offsetWidth)>0?Z.current.offsetWidth+4:0,l=Math.max(a-i-r,250);T({paginationMaxWidth:l,noticeBoxMaxWidth:n.offsetWidth})},a=new window.ResizeObserver(t);return a.observe(e),t(),a.disconnect}),[]),H=(0,c.useCallback)((e=>k({page:e})),[]),{isDisconnected:U}=(0,n.Uw)(),{headers:$}=Me(I);$&&x&&($.includes(x)||k({sortField:null,sortDirection:"asc"}));const{fetching:j,error:X,data:K}=Ae({filters:t,visualization:I,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:R,page:I!==O.current?1:M,sortField:x,sortDirection:P}),J=(0,c.useRef)(null),ne=(0,c.useRef)(null),De=(0,c.useRef)(null),Te=(0,c.useMemo)((()=>{if(!(j&&null!=J&&J.current&&null!=ne&&ne.current&&null!=De&&De.current))return"calc(50% - 12px)";const e=J.current.clientHeight,t=ne.current.offsetHeight,a=e-t-De.current.offsetHeight;return`${Math.round(t+a/2-12)}px`}),[j]);if((0,c.useEffect)((()=>{O.current=I,H(1)}),[I,H]),(0,c.useEffect)((()=>{if(K&&I){var e;const t=K.headers.filter((e=>e.legendSet)).map((e=>e.legendSet)),a=t.filter(((e,a)=>{var n;return t.findIndex((t=>t.id===e.id))===a&&(null===(n=e.legends)||void 0===n?void 0:n.length)}));a.length&&null!==(e=I.legend)&&void 0!==e&&e.showKey?v(a):v([])}else v([])}),[K,I]),(0,c.useEffect)((()=>{X&&o&&o(X)}),[X,o]),!K||X)return null;const xe=(e=>{switch(e){case"COMFORTABLE":return we;case"COMPACT":return ze;default:return _e}})(I.displayDensity),Ne=(e=>{switch(e){case"LARGE":return ye;case"SMALL":return Ee;default:return Se}})(I.fontSize),Pe=String(Math.max(K.headers.length,1)),Re=e=>{let{name:t,direction:a}=e;return k({sortField:t,sortDirection:a,page:1})},ke=Y(N(I)),Ie=e=>{const t=ae(e),a=Number.isInteger(e.stageOffset)?e.name.replace(/\[-?\d+\]/,""):e.name;return c.createElement("span",{className:D()(he,ve),onClick:s?()=>s((e=>Object.keys(ke).find((t=>ke[t]===e)))(a)||a):void 0},t)};return c.createElement("div",{className:le,ref:F},c.createElement("div",{"data-test":"line-list-fetch-container",className:D()(se,{[oe]:j}),ref:J},c.createElement("div",{className:de,style:{top:Te}}),c.createElement("div",{className:ue},q&&c.createElement("div",{className:ce,ref:d,style:{maxWidth:C.noticeBoxMaxWidth}},c.createElement(y.f,{warning:!0},f.Z.t("This line list may show data that was not available when the interpretation was written."))),c.createElement(S.w,{scrollHeight:Le(A,d),scrollWidth:"100%",width:"auto",className:fe,dataTest:"line-list-table",ref:u},c.createElement(E.s,{ref:ne},c.createElement(w.U,null,K.headers.map(((e,t)=>e?c.createElement(_.p,{fixed:!0,top:"0",key:e.name,name:e.name,onSortIconClick:Re,sortDirection:U?void 0:e.name===x?P:"default",sortIconTitle:f.Z.t("Sort by {{column}}",{column:ae(e)}),className:D()(he,Ne,xe,"bordered"),dataTest:"table-header"},Ie(e)):c.createElement(_.p,{fixed:!0,top:"0",key:`undefined_${t}`,className:D()(he,Ne,xe),dataTest:"table-header"}))))),c.createElement(z.R,{dataTest:"table-body"},K.rows.map(((e,t)=>c.createElement(w.U,{key:t,dataTest:"table-row"},e.map(((e,t)=>{var a,n,i;return c.createElement(b.W,{key:t,className:D()(be,Ne,xe,{[Ve]:!e,[Ce]:(i=K.headers[t],[p.FV,p.$r,p.VX,p.M7,p.iq,p.y3,p.SA,p.zf,p.$d,p.Wt,p.so].includes(i.valueType)&&!i.optionSet)},"bordered"),backgroundColor:(null===(a=I.legend)||void 0===a?void 0:a.style)===g.UJ?(0,g.i3)(K.headers[t].legendSet,e):void 0,dataTest:"table-cell"},c.createElement("div",{style:(null===(n=I.legend)||void 0===n?void 0:n.style)===g.Xr?{color:(0,g.i3)(K.headers[t].legendSet,e)}:{}},((e,t)=>(null==t?void 0:t.valueType)===p.Xw?c.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},e):te({value:e,header:t,visualization:I}))(e,K.headers[t])))})))))),c.createElement(V.j,{className:pe,ref:De},c.createElement(w.U,null,c.createElement(b.W,{colSpan:Pe,staticStyle:!0,className:me},c.createElement("div",{className:D()(ge,xe),style:{maxWidth:C.paginationMaxWidth,minWidth:250}},c.createElement(qe,{offline:U,disabled:U||j,page:K.pager.page,pageSize:K.pager.pageSize||100,isLastPage:K.pager.isLastPage,onPageChange:H,onPageSizeChange:e=>k({pageSize:e,page:1}),pageSizeSelectText:f.Z.t("Rows per page"),pageLength:K.rows.length,pageSummaryText:e=>{let{firstItem:t,lastItem:a,page:n}=e;return f.Z.t("Page {{page}}, row {{firstItem}}-{{lastItem}}",{firstItem:t,lastItem:a,page:n})}}))))))),Boolean(h.length)&&c.createElement("div",{className:re,"data-test":"visualization-legend-key",ref:Z},c.createElement(m.Z,{legendSets:h}))))};Oe.defaultProps={displayProperty:"name",isVisualizationLoading:!1,onResponsesReceived:Function.prototype},Oe.propTypes={displayProperty:u().string.isRequired,isVisualizationLoading:u().bool.isRequired,visualization:u().object.isRequired,onResponsesReceived:u().func.isRequired,filters:u().object,onColumnHeaderClick:u().func,onError:u().func};const Ze="READY",Fe="INSTALLING";function He(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(Ze)}}const Ue=()=>c.createElement(i.m,null,c.createElement(r.M,null,c.createElement(l.V,null))),$e=e=>{let{id:t,children:a,cacheNow:i,isParentCached:r}=e;const{startRecording:l,isCached:s,remove:d}=(0,n.Of)(t);return(0,c.useEffect)((()=>{i&&l({onError:console.error})}),[i]),(0,c.useEffect)((()=>{const e=o().on("removeCachedData",{window:window.parent},(()=>d()));return()=>e.cancel()}),[d]),(0,c.useEffect)((()=>{!r&&s&&d()}),[r]),c.createElement(n.MW,{id:t,loadingMask:Ue},a)};$e.propTypes={cacheNow:u().bool,children:u().node,id:u().string,isParentCached:u().bool};const Qe=e=>{o().send(window.parent,"installationStatus",{installationStatus:e})},je=()=>{const[e,t]=(0,c.useState)(),a=e=>t(e.data);return(0,c.useEffect)((()=>{o().send(window.parent,"getProps").then(a).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?Ze:a.installing?(He({installingWorker:a.installing,onStateChange:t}),Fe):(a.onupdatefound=()=>{t(Fe);const e=a.installing;e&&He({installingWorker:e,onStateChange:t})},null):null}({onStateChange:Qe}).then(Qe);const e=o().on("newProps",{window:window.parent},a);return()=>e.cancel()}),[]),e?c.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},c.createElement($e,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},c.createElement(Oe,e))):null}},2480:()=>{}}]);