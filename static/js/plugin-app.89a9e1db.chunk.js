"use strict";(self.webpackChunkline_listing_app=self.webpackChunkline_listing_app||[]).push([[2143],{2127:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Re});var n=a(3135),i=a(8594),r=a(4479),l=a(6329),s=a(1006),o=a.n(s),d=a(3665),c=a.n(d),u=a(2085),p=a(1475),m=a(9551),g=a(2703),h=a(4584),v=a(9308),y=a(9500),f=a(5215),E=a(1250),S=a(9647),w=a(4991),_=a(1949),z=a(101),b=a(2305),D=a(6206),T=a.n(D);var V=a(5633),C=a(9941),P=a.n(C),N=a(5133);new Set([N.P6,N.qI,N.xi,N.PH,N.M6]),new Set([N.zC]);const I="programStatus",k="eventStatus",R="createdBy",x="lastUpdatedBy",L="eventDate",M="enrollmentDate",A="incidentDate",O="scheduledDate",Z="lastUpdated",U=new Set([L,M,A,O,Z]);var F=a(4805),H=a(1517),q=a(2644);const $="COMPLETED",Q="EVENT",j="ENROLLMENT",W={[F.rx]:"ouname",[I]:"programstatus",[k]:"eventstatus",[R]:"createdbydisplayname",[x]:"lastupdatedbydisplayname",[L]:"eventdate",[M]:"enrollmentdate",[A]:"incidentdate",[O]:"scheduleddate",[Z]:"lastupdated"},B=e=>{let{showHierarchy:t}=e;const a=Object.assign({},W);return t&&(a[F.rx]="ounamehierarchy"),a},X={[Q]:L,[j]:M},G=(e,t)=>{let{outputType:a,type:n}=t;return e.filter((e=>!["longitude","latitude"].includes(e.dimension))).map((e=>e.dimensionType===N.cl?{...e,dimensionType:N.P6}:e.dimension===F.vi&&n===q.UU?{...e,dimension:X[a],dimensionType:N.KV}:e))},K=(q.UU,q.Zp,e=>{let{value:t,header:a={},visualization:n={}}=e;return[W.eventStatus,W.programStatus].includes(a.name)?{ACTIVE:h.Z.t("Active"),CANCELLED:h.Z.t("Cancelled"),[$]:h.Z.t("Completed"),SCHEDULE:h.Z.t("Scheduled")}[t]||t:[p.$d,p.Wt].includes(a.valueType)?t&&P()(t).format(a.name===W.lastUpdated||a.valueType===p.Wt?"yyyy-MM-DD hh:mm":"yyyy-MM-DD"):(null==a?void 0:a.valueType)===p.H?t&&P()(t).format("yyyy-MM-DD"):(0,V.Q)(t,a.valueType||p.kl,a.optionSet?{}:{digitGroupSeparator:n.digitGroupSeparator,skipRounding:!1})}),J=function(){let{stageOffset:e,column:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";if(Number.isInteger(e)){let a;return 0===e?a=h.Z.t("most recent"):1===e?a=h.Z.t("oldest"):e>1?a=h.Z.t("oldest {{repeatEventIndex}}",{repeatEventIndex:"+"+(e-1)}):e<0&&(a=h.Z.t("most recent {{repeatEventIndex}}",{repeatEventIndex:e})),`${t} (${a})`}return t},Y="Visualization_legendKeyScrollbox__xeUwY",ee="Visualization_pluginContainer__oXPo4",te="Visualization_fetchIndicator__I2E9y",ae="Visualization_fetching__7HD9F",ne="Visualization_stickyFooter__Dd34A",ie="Visualization_footerCell__Fncu5",re="Visualization_stickyNavigation__0J6KV",le="Visualization_dataTable__5lDA5",se="Visualization_headerCell__4qkrt",oe="Visualization_dimensionModalHandler__yWmOU",de="Visualization_fontSizeLarge__z2BH2",ce="Visualization_fontSizeNormal__jf7Sh",ue="Visualization_fontSizeSmall__FfsnC",pe="Visualization_sizeComfortable__Su+7Q",me="Visualization_sizeNormal__gHiph",ge="Visualization_sizeCompact__8D9I5",he="Visualization_cell__6WA8H",ve="Visualization_emptyCell__5ufEQ",ye="Visualization_nowrap__L4Sfl";var fe=a(3100);const Ee="NV",Se=()=>({1:h.Z.t("Yes"),0:h.Z.t("No"),[Ee]:h.Z.t("Not answered")}),we={[j]:"enrollments",[Q]:"events"},_e=[R,x],ze=(e,t,a)=>{var n,i;switch(t.valueType){case p.zU:case p.mb:return Se()[e||Ee];default:return t.optionSet?(null===(n=((e,t)=>Object.values(t).find((t=>t.code===e)))(e,a))||void 0===n?void 0:n.name)||e:(null===(i=a[e])||void 0===i?void 0:i.name)||e}},be=e=>{const t={},a=e=>{const a=[];return e.forEach((e=>{const n=e.dimension;var i,r;(e=>U.has(e))(n)||n===k||n===I?null!==(i=e.items)&&void 0!==i&&i.length&&(t[n]=null===(r=e.items)||void 0===r?void 0:r.map((e=>e.id))):_e.includes(n)||a.push(e)})),a},n=a(e[H.Aq]),i=a(e[H.dQ]),r=a(e[H.lT]),l=B({showHierarchy:e.showHierarchy}),s=[...e[H.Aq],...e[H.dQ]].map((e=>{var t;let{dimension:a,programStage:n,repetition:i}=e;const r=null!=n&&n.id?`${n.id}.${a}`:l[a]||a;return null!=i&&null!==(t=i.indexes)&&void 0!==t&&t.length?i.indexes.map((e=>r.replace(/\./,`[${e}].`))):r}));return{adaptedVisualization:{[H.Aq]:n,[H.dQ]:i,[H.lT]:r},headers:s,parameters:t}},De=async e=>{let{analyticsEngine:t,visualization:a,pageSize:n,page:i,relativePeriodDate:r,sortField:l,sortDirection:s,displayProperty:o}=e;const{adaptedVisualization:d,headers:c,parameters:u}=be(a);let p=(new t.request).fromVisualization(d).withParameters({headers:c,totalPages:!1,...u}).withProgram(a.program.id).withDisplayProperty(o.toUpperCase()).withOutputType(a.outputType).withPageSize(n).withPage(i).withIncludeMetadataDetails();var m;a.outputType!==j&&(p=p.withStage(null===(m=a.programStage)||void 0===m?void 0:m.id));if(r&&(p=p.withRelativePeriodDate(r)),l)switch(s){case"asc":p=p.withAsc(l);break;case"desc":p=p.withDesc(l)}const g=(h=a.outputType,we[h]);var h;return await t[g].getQuery(p)},Te={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}},Ve=async e=>{let{legendSetIds:t,dataEngine:a}=e;if(!t.length)return[];const n=await(async e=>{let{dataEngine:t,ids:a}=e;return(await t.query({legendSets:Te},{variables:{ids:a}})).legendSets.legendSets})({dataEngine:a,ids:t});return n},Ce=e=>{let{visualization:t,filters:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:s,page:o,sortField:d,sortDirection:c}=e;const m=(0,n.bQ)(),[h]=(0,u.useState)((()=>fe.Z.getAnalytics(m))),v=(0,u.useRef)(!1),[y,f]=(0,u.useState)(!0),[E,S]=(0,u.useState)(!0),[w,_]=(0,u.useState)(void 0),[z,b]=(0,u.useState)(null),D=null==a?void 0:a.relativePeriodDate,T=(0,u.useCallback)((async()=>{try{var e,a,n,i;const u=await De({analyticsEngine:h,page:o,pageSize:s,relativePeriodDate:D,sortDirection:c,sortField:d,visualization:t,displayProperty:r}),y=(e=>e.headers.map(((t,a)=>{const n={...t,index:a},{dimensionId:i,programStageId:r}=(e=>{const[t,a]=e.split(".").reverse(),[n,i]=(a||"").split("[");return{dimensionId:t,programStageId:n,repetitionIndex:(null==i?void 0:i.length)&&i.substring(0,i.indexOf("]"))}})(t.name);return r&&e.headers.filter((e=>e.name.includes(i))).length>1&&(n.column+=` - ${e.metaData.items[r].name}`),n})))(u),E=((e,t)=>{const a=[];for(let n=0,i=e.rows.length;n<i;n++){const i=e.rows[n],r=[];for(let a=0,n=t.length;a<n;a++){const n=t[a],l=i[n.index];r.push(ze(l,n,e.metaData.items))}a.push(r)}return a})(u,y),w=u.metaData.pager,z=[],T=y.reduce(((e,t)=>{var a;return{...e,[t.name]:null===(a=u.metaData.items[t.name])||void 0===a?void 0:a.legendSet}}),{});(null===(e=t.legend)||void 0===e?void 0:e.strategy)===g.zv&&null!==(a=t.legend)&&void 0!==a&&null!==(n=a.set)&&void 0!==n&&n.id?z.push(t.legend.set.id):(null===(i=t.legend)||void 0===i?void 0:i.strategy)===g.EE&&Object.values(T).filter((e=>e)).forEach((e=>z.push(e)));const V=await Ve({legendSetIds:z,dataEngine:m});V.length&&y.filter((e=>{return t=e.valueType,[p.FV,p.SA,p.y3,p.$r,p.VX,p.M7,p.iq].includes(t);var t})).forEach((e=>{switch(t.legend.strategy){case g.zv:e.legendSet=V[0];break;case g.EE:e.legendSet=V.find((t=>t.id===T[e.name]))}})),v.current&&_(void 0),v.current&&b({headers:y,rows:E,pager:w}),l(u)}catch(e){v.current&&_(e)}finally{v.current&&f(!1),v.current&&S(!1)}}),[h,o,s,D,c,d,t]);return(0,u.useEffect)((()=>(v.current=!0,()=>{v.current=!1})),[]),(0,u.useEffect)((()=>{S(!0),T()}),[t,o,s,d,c,D]),(0,u.useEffect)((()=>{i&&(S(!1),f(!1),_(void 0),b(null))}),[i]),{loading:y,fetching:E,error:w,data:z,isGlobalLoading:i}},Pe=e=>{let{offline:t,...a}=e;return t?u.createElement(v.u,{content:h.Z.t("Not available offline")},u.createElement(y.t,a)):u.createElement(y.t,a)};Pe.propTypes={offline:c().bool};const Ne=e=>{let{filters:t,visualization:a,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,onColumnHeaderClick:s,onError:o}=e;const[d,c]=(0,u.useState)([]),[{sortField:v,sortDirection:y,pageSize:D,page:V},C]=(0,u.useReducer)(((e,t)=>({...e,...t})),{sortField:null,sortDirection:"asc",page:1,pageSize:100}),P=(0,u.useMemo)((()=>a&&(e=>{const t=G(e[H.Aq],e),a=G(e[H.dQ],e),n=G(e[H.lT],e);e.completedOnly&&e.outputType===Q&&n.push({dimension:k,items:[{id:$}]});const i={...e};return delete i.completedOnly,{...i,[H.Aq]:t,[H.dQ]:a,[H.lT]:n}})(a)),[a]),N=(0,u.useRef)(P),I=(0,u.useCallback)((e=>C({page:e})),[]),{isDisconnected:R}=(0,n.Uw)(),{headers:x}=be(P);x&&v&&(x.includes(v)||C({sortField:null,sortDirection:"asc"}));const{fetching:L,error:M,data:A}=Ce({filters:t,visualization:P,isVisualizationLoading:i,displayProperty:r,onResponsesReceived:l,pageSize:D,page:P!==N.current?1:V,sortField:v,sortDirection:y});if((0,u.useEffect)((()=>{N.current=P,I(1)}),[P,I]),(0,u.useEffect)((()=>{if(A&&P){var e;const t=A.headers.filter((e=>e.legendSet)).map((e=>e.legendSet)),a=t.filter(((e,a)=>{var n;return t.findIndex((t=>t.id===e.id))===a&&(null===(n=e.legends)||void 0===n?void 0:n.length)}));a.length&&null!==(e=P.legend)&&void 0!==e&&e.showKey?c(a):c([])}else c([])}),[A,P]),(0,u.useEffect)((()=>{M&&o&&o(M)}),[M,o]),!A||M)return null;const O=(e=>{switch(e){case"COMFORTABLE":return pe;case"COMPACT":return ge;default:return me}})(P.displayDensity),Z=(e=>{switch(e){case"LARGE":return de;case"SMALL":return ue;default:return ce}})(P.fontSize),U=String(Math.max(A.headers.length,1)),F=e=>{let{name:t,direction:a}=e;return C({sortField:t,sortDirection:a,page:1})},q=B({showHierarchy:P.showHierarchy}),j=e=>{const t=J(e),a=Number.isInteger(e.stageOffset)?e.name.replace(/\[-?\d+\]/,""):e.name;return u.createElement("span",{className:T()(se,oe),onClick:s?()=>s((e=>Object.keys(q).find((t=>q[t]===e)))(a)||a):void 0},t)},W=!(null==t||!t.relativePeriodDate);return u.createElement("div",{className:ee},u.createElement("div",{"data-test":"line-list-loading-indicator",className:T()(te,{[ae]:L})},u.createElement(f.w,{scrollHeight:W?"calc(100vh - 285px)":"100%",scrollWidth:"100%",width:"auto",className:le,dataTest:"line-list-table"},u.createElement(E.s,null,u.createElement(S.U,null,A.headers.map(((e,t)=>e?u.createElement(w.p,{fixed:!0,top:"0",key:e.name,name:e.name,onSortIconClick:F,sortDirection:R?void 0:e.name===v?y:"default",sortIconTitle:h.Z.t("Sort by {{column}}",{column:J(e)}),className:T()(se,Z,O,"bordered"),dataTest:"table-header"},j(e)):u.createElement(w.p,{fixed:!0,top:"0",key:`undefined_${t}`,className:T()(se,Z,O),dataTest:"table-header"}))))),u.createElement(_.R,{dataTest:"table-body"},A.rows.map(((e,t)=>u.createElement(S.U,{key:t,dataTest:"table-row"},e.map(((e,t)=>{var a,n,i;return u.createElement(z.W,{key:t,className:T()(he,Z,O,{[ve]:!e,[ye]:(i=A.headers[t],[p.FV,p.$r,p.VX,p.M7,p.iq,p.y3,p.SA,p.zf,p.$d,p.Wt,p.so].includes(i.valueType)&&!i.optionSet)},"bordered"),backgroundColor:(null===(a=P.legend)||void 0===a?void 0:a.style)===g.UJ?(0,g.i3)(A.headers[t].legendSet,e):void 0,dataTest:"table-cell"},u.createElement("div",{style:(null===(n=P.legend)||void 0===n?void 0:n.style)===g.Xr?{color:(0,g.i3)(A.headers[t].legendSet,e)}:{}},((e,t)=>(null==t?void 0:t.valueType)===p.Xw?u.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},e):K({value:e,header:t,visualization:P}))(e,A.headers[t])))})))))),u.createElement(b.j,{className:ne},u.createElement(S.U,null,u.createElement(z.W,{colSpan:U,staticStyle:!0,className:ie},u.createElement("div",{className:T()(re,O)},u.createElement(Pe,{offline:R,disabled:R||L,page:A.pager.page,pageSize:A.pager.pageSize||100,isLastPage:A.pager.isLastPage,onPageChange:I,onPageSizeChange:e=>C({pageSize:e,page:1}),pageSizeSelectText:h.Z.t("Rows per page"),pageLength:A.rows.length,pageSummaryText:e=>{let{firstItem:t,lastItem:a,page:n}=e;return h.Z.t("Page {{page}}, row {{firstItem}}-{{lastItem}}",{firstItem:t,lastItem:a,page:n})}}))))))),Boolean(d.length)&&u.createElement("div",{className:Y,"data-test":"visualization-legend-key"},u.createElement(m.Z,{legendSets:d})))};Ne.defaultProps={displayProperty:"name",isVisualizationLoading:!1,onResponsesReceived:Function.prototype},Ne.propTypes={displayProperty:c().string.isRequired,isVisualizationLoading:c().bool.isRequired,visualization:c().object.isRequired,onResponsesReceived:c().func.isRequired,filters:c().object,onColumnHeaderClick:c().func,onError:c().func};const Ie=()=>u.createElement(i.m,null,u.createElement(r.M,null,u.createElement(l.V,null))),ke=e=>{let{id:t,children:a,cacheNow:i,isParentCached:r}=e;const{startRecording:l,isCached:s,remove:d}=(0,n.Of)(t);return(0,u.useEffect)((()=>{i&&l({onError:console.error})}),[i]),(0,u.useEffect)((()=>{const e=o().on("removeCachedData",{window:window.parent},(()=>d()));return()=>e.cancel()}),[d]),(0,u.useEffect)((()=>{!r&&s&&d()}),[r]),u.createElement(n.MW,{id:t,loadingMask:Ie},a)};ke.propTypes={cacheNow:c().bool,children:c().node,id:c().string,isParentCached:c().bool};const Re=()=>{const[e,t]=(0,u.useState)(),a=e=>t(e.data);return(0,u.useEffect)((()=>{o().send(window.parent,"getProps").then(a).catch((e=>console.error(e)));const e=o().on("newProps",{window:window.parent},a);return()=>e.cancel()}),[]),e?u.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},u.createElement(ke,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},u.createElement(Ne,e))):null}}}]);