"use strict";(self.webpackChunkline_listing_app=self.webpackChunkline_listing_app||[]).push([[2143],{2127:(e,t,a)=>{a.r(t),a.d(t,{default:()=>we});var i=a(1006),n=a.n(i),l=a(2085),r=a(1475),s=a(9551),o=a(2703),d=a(4584),u=a(5215),c=a(1250),p=a(9647),g=a(7955),m=a(1949),v=a(101),y=a(2305),h=a(4304),f=a(6206),S=a.n(f),E=a(3665),z=a.n(E);var _=a(5633),w=a(9941),D=a.n(w),T=a(5133);new Set([T.P6,T.qI,T.xi,T.PH,T.M6]),new Set([T.zC]);const V="programStatus",b="eventStatus",C="createdBy",P="lastUpdatedBy",I="eventDate",N="enrollmentDate",k="incidentDate",x="scheduledDate",R="lastUpdated",L=new Set([I,N,k,x,R]);var A=a(4805),M=a(1517),F=a(2644);const U="COMPLETED",Z="EVENT",O="ENROLLMENT",q={[A.rx]:"ouname",[V]:"programstatus",[b]:"eventstatus",[C]:"createdbydisplayname",[P]:"lastupdatedbydisplayname",[I]:"eventdate",[N]:"enrollmentdate",[k]:"incidentdate",[x]:"scheduleddate",[R]:"lastupdated"},H={[Z]:I,[O]:N},Q=(e,t)=>{let{outputType:a,type:i}=t;return e.filter((e=>!["longitude","latitude"].includes(e.dimension))).map((e=>e.dimensionType===T.cl?{...e,dimensionType:T.P6}:e.dimension===A.vi&&i===F.UU?{...e,dimension:H[a],dimensionType:T.KV}:e))},$=(F.UU,F.Zp,e=>{let{value:t,header:a={},visualization:i={}}=e;return[q.eventStatus,q.programStatus].includes(a.name)?{ACTIVE:d.Z.t("Active"),CANCELLED:d.Z.t("Cancelled"),[U]:d.Z.t("Completed"),SCHEDULE:d.Z.t("Scheduled")}[t]||t:[r.$d,r.Wt].includes(a.valueType)?t&&D()(t).format(a.name===q.lastUpdated||a.valueType===r.Wt?"yyyy-MM-DD hh:mm":"yyyy-MM-DD"):(null==a?void 0:a.valueType)===r.H?t&&D()(t).format("yyyy-MM-DD"):(0,_.Q)(t,a.valueType||r.kl,{digitGroupSeparator:i.digitGroupSeparator,skipRounding:!1})}),j="Visualization_legendKeyScrollbox__xeUwY",W="Visualization_pluginContainer__oXPo4",B="Visualization_fetchIndicator__I2E9y",G="Visualization_fetching__7HD9F",K="Visualization_stickyFooter__Dd34A",X="Visualization_footerCell__Fncu5",J="Visualization_stickyNavigation__0J6KV",Y="Visualization_dataTable__5lDA5",ee="Visualization_headerCell__4qkrt",te="Visualization_dimensionModalHandler__yWmOU",ae="Visualization_fontSizeLarge__z2BH2",ie="Visualization_fontSizeNormal__jf7Sh",ne="Visualization_fontSizeSmall__FfsnC",le="Visualization_sizeComfortable__Su+7Q",re="Visualization_sizeNormal__gHiph",se="Visualization_sizeCompact__8D9I5",oe="Visualization_cell__6WA8H",de="Visualization_emptyCell__5ufEQ";var ue=a(3100),ce=a(1014);const pe="NV",ge=()=>({1:d.Z.t("Yes"),0:d.Z.t("No"),[pe]:d.Z.t("Not answered")}),me={[O]:"enrollments",[Z]:"events"},ve=[C,P],ye=(e,t,a)=>{var i,n;switch(t.valueType){case r.zU:case r.mb:return ge()[e||pe];default:return t.optionSet?(null===(i=((e,t)=>Object.values(t).find((t=>t.code===e)))(e,a))||void 0===i?void 0:i.name)||e:(null===(n=a[e])||void 0===n?void 0:n.name)||e}},he=e=>{const t={},a=e=>{const a=[];return e.forEach((e=>{const i=e.dimension;var n,l;(e=>L.has(e))(i)||i===b||i===V?null!==(n=e.items)&&void 0!==n&&n.length&&(t[i]=null===(l=e.items)||void 0===l?void 0:l.map((e=>e.id))):ve.includes(i)||a.push(e)})),a},i=a(e[M.Aq]),n=a(e[M.dQ]),l=a(e[M.lT]),r=[...e[M.Aq],...e[M.dQ]].map((e=>{var t;let{dimension:a,programStage:i,repetition:n}=e;const l=null!=i&&i.id?`${i.id}.${a}`:q[a]||a;return null!=n&&null!==(t=n.indexes)&&void 0!==t&&t.length?n.indexes.map((e=>l.replace(/\./,`[${e}].`))):l}));return{adaptedVisualization:{[M.Aq]:i,[M.dQ]:n,[M.lT]:l},headers:r,parameters:t}},fe=async e=>{let{analyticsEngine:t,visualization:a,pageSize:i,page:n,relativePeriodDate:l,sortField:r,sortDirection:s,displayProperty:o}=e;const{adaptedVisualization:d,headers:u,parameters:c}=he(a);let p=(new t.request).fromVisualization(d).withParameters({headers:u,totalPages:!1,...c}).withProgram(a.program.id).withDisplayProperty(o.toUpperCase()).withOutputType(a.outputType).withPageSize(i).withPage(n).withIncludeMetadataDetails();var g;a.outputType!==O&&(p=p.withStage(null===(g=a.programStage)||void 0===g?void 0:g.id));if(l&&(p=p.withRelativePeriodDate(l)),r)switch(s){case"asc":p=p.withAsc(r);break;case"desc":p=p.withDesc(r)}const m=(v=a.outputType,me[v]);var v;return await t[m].getQuery(p)},Se={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}},Ee=async e=>{let{legendSetIds:t,dataEngine:a}=e;if(!t.length)return[];const i=await(async e=>{let{dataEngine:t,ids:a}=e;return(await t.query({legendSets:Se},{variables:{ids:a}})).legendSets.legendSets})({dataEngine:a,ids:t});return i},ze=e=>{let{visualization:t,filters:a,isVisualizationLoading:i,nameProp:n,onResponsesReceived:s,pageSize:d,page:u,sortField:c,sortDirection:p}=e;const g=(0,ce.bQ)(),[m]=(0,l.useState)((()=>ue.Z.getAnalytics(g))),v=(0,l.useRef)(!1),[y,h]=(0,l.useState)(!0),[f,S]=(0,l.useState)(!0),[E,z]=(0,l.useState)(void 0),[_,w]=(0,l.useState)(null),D=null==a?void 0:a.relativePeriodDate,T=(0,l.useCallback)((async()=>{try{var e,a,i,l;const y=await fe({analyticsEngine:m,page:u,pageSize:d,relativePeriodDate:D,sortDirection:p,sortField:c,visualization:t,nameProp:n}),f=(e=>e.headers.map(((t,a)=>{const i={...t,index:a},{dimensionId:n,programStageId:l}=(e=>{const[t,a]=e.split(".").reverse(),[i,n]=(a||"").split("[");return{dimensionId:t,programStageId:i,repetitionIndex:(null==n?void 0:n.length)&&n.substring(0,n.indexOf("]"))}})(t.name);return l&&e.headers.filter((e=>e.name.includes(n))).length>1&&(i.column+=` - ${e.metaData.items[l].name}`),i})))(y),E=((e,t)=>{const a=[];for(let i=0,n=e.rows.length;i<n;i++){const n=e.rows[i],l=[];for(let a=0,i=t.length;a<i;a++){const i=t[a],r=n[i.index];l.push(ye(r,i,e.metaData.items))}a.push(l)}return a})(y,f),_=y.metaData.pager,T=[],V=f.reduce(((e,t)=>{var a;return{...e,[t.name]:null===(a=y.metaData.items[t.name])||void 0===a?void 0:a.legendSet}}),{});(null===(e=t.legend)||void 0===e?void 0:e.strategy)===o.zv&&null!==(a=t.legend)&&void 0!==a&&null!==(i=a.set)&&void 0!==i&&i.id?T.push(t.legend.set.id):(null===(l=t.legend)||void 0===l?void 0:l.strategy)===o.EE&&Object.values(V).filter((e=>e)).forEach((e=>T.push(e)));const b=await Ee({legendSetIds:T,dataEngine:g});b.length&&f.filter((e=>{return t=e.valueType,[r.FV,r.SA,r.y3,r.$r,r.VX,r.M7,r.iq].includes(t);var t})).forEach((e=>{switch(t.legend.strategy){case o.zv:e.legendSet=b[0];break;case o.EE:e.legendSet=b.find((t=>t.id===V[e.name]))}})),v.current&&z(void 0),v.current&&w({headers:f,rows:E,pager:_}),s(y)}catch(e){v.current&&z(e)}finally{v.current&&h(!1),v.current&&S(!1)}}),[m,u,d,D,p,c,t]);return(0,l.useEffect)((()=>(v.current=!0,()=>{v.current=!1})),[]),(0,l.useEffect)((()=>{S(!0),T()}),[t,u,d,c,p,D]),(0,l.useEffect)((()=>{i&&(S(!1),h(!1),z(void 0),w(null))}),[i]),{loading:y,fetching:f,error:E,data:_,isGlobalLoading:i}},_e=e=>{let{filters:t,visualization:a,isVisualizationLoading:i,displayProperty:n,onResponsesReceived:f,onColumnHeaderClick:E,onError:z}=e;const[_,w]=(0,l.useState)([]),[{sortField:D,sortDirection:T,pageSize:V,page:C},P]=(0,l.useState)({sortField:null,sortDirection:"asc",page:1,pageSize:100}),I=!(null==t||!t.relativePeriodDate),N=(0,l.useMemo)((()=>a&&(e=>{const t=Q(e[M.Aq],e),a=Q(e[M.dQ],e),i=Q(e[M.lT],e);e.completedOnly&&e.outputType===Z&&i.push({dimension:b,items:[{id:U}]});const n={...e};return delete n.completedOnly,{...n,[M.Aq]:t,[M.dQ]:a,[M.lT]:i}})(a)),[a]),{fetching:k,error:x,data:R}=ze({filters:t,visualization:N,isVisualizationLoading:i,displayProperty:n,onResponsesReceived:f,pageSize:V,page:C,sortField:D,sortDirection:T});if((0,l.useEffect)((()=>{if(R&&N){var e;const t=R.headers.filter((e=>e.legendSet)).map((e=>e.legendSet)),a=t.filter(((e,a)=>{var i;return t.findIndex((t=>t.id===e.id))===a&&(null===(i=e.legends)||void 0===i?void 0:i.length)}));a.length&&null!==(e=N.legend)&&void 0!==e&&e.showKey?w(a):w([])}else w([])}),[R,N]),(0,l.useEffect)((()=>{x&&z&&z(x)}),[x,z]),!R||x)return null;const L=(e=>{switch(e){case"COMFORTABLE":return le;case"COMPACT":return se;default:return re}})(N.displayDensity),A=(e=>{switch(e){case"LARGE":return ae;case"SMALL":return ne;default:return ie}})(N.fontSize),F=String(Math.max(R.headers.length,1)),O=e=>{let{name:t,direction:a}=e;return P({sortField:t,sortDirection:a,pageSize:V,page:1})},H=e=>{const t=function(){let{stageOffset:e,column:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";if(Number.isInteger(e)){let a;return 0===e?a=d.Z.t("most recent"):1===e?a=d.Z.t("oldest"):e>1?a=d.Z.t("oldest {{repeatEventIndex}}",{repeatEventIndex:"+"+(e-1)}):e<0&&(a=d.Z.t("most recent {{repeatEventIndex}}",{repeatEventIndex:e})),`${t} (${a})`}return t}(e),a=Number.isInteger(e.stageOffset)?e.name.replace(/\[-?\d+\]/,""):e.name;return l.createElement("span",{className:S()(ee,te),onClick:E?()=>E((e=>Object.keys(q).find((t=>q[t]===e)))(a)||a):void 0},t)};return l.createElement("div",{className:W},l.createElement("div",{className:S()(B,{[G]:k})},l.createElement(u.w,{scrollHeight:I?"calc(100vh - 285px)":"100%",scrollWidth:"100%",width:"auto",className:Y,dataTest:"line-list-table"},l.createElement(c.s,null,l.createElement(p.U,null,R.headers.map(((e,t)=>e?l.createElement(g.p,{fixed:!0,top:"0",key:e.name,name:e.name,onSortIconClick:O,sortDirection:e.name===D?T:"default",className:S()(ee,A,L),dataTest:"table-header"},H(e)):l.createElement(g.p,{fixed:!0,top:"0",key:`undefined_${t}`,className:S()(ee,A,L),dataTest:"table-header"}))))),l.createElement(m.R,{dataTest:"table-body"},R.rows.map(((e,t)=>l.createElement(p.U,{key:t,dataTest:"table-row"},e.map(((e,t)=>{var a,i;return l.createElement(v.W,{key:t,className:S()(oe,A,L,{[de]:!e}),backgroundColor:(null===(a=N.legend)||void 0===a?void 0:a.style)===o.UJ?(0,o.i3)(R.headers[t].legendSet,e):void 0,dataTest:"table-cell"},l.createElement("div",{style:(null===(i=N.legend)||void 0===i?void 0:i.style)===o.Xr?{color:(0,o.i3)(R.headers[t].legendSet,e)}:{}},((e,t)=>(null==t?void 0:t.valueType)===r.Xw?l.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},e):$({value:e,header:t,visualization:N}))(e,R.headers[t])))})))))),l.createElement(y.j,{className:K},l.createElement(p.U,null,l.createElement(v.W,{colSpan:F,staticStyle:!0,className:X},l.createElement("div",{className:S()(J,L)},l.createElement(h.t,{disabled:k,page:R.pager.page,pageSize:R.pager.pageSize||100,isLastPage:R.pager.isLastPage,onPageChange:e=>P({sortField:D,sortDirection:T,pageSize:V,page:e}),onPageSizeChange:e=>P({sortField:D,sortDirection:T,pageSize:e,page:1}),pageSizeSelectText:d.Z.t("Rows per page"),pageLength:R.rows.length,pageSummaryText:e=>{let{firstItem:t,lastItem:a,page:i}=e;return d.Z.t("Page {{page}}, row {{firstItem}}-{{lastItem}}",{firstItem:t,lastItem:a,page:i})}}))))))),Boolean(_.length)&&l.createElement("div",{className:j,"data-test":"visualization-legend-key"},l.createElement(s.Z,{legendSets:_})))};_e.defaultProps={isVisualizationLoading:!1,onResponsesReceived:Function.prototype},_e.propTypes={displayProperty:z().string.isRequired,isVisualizationLoading:z().bool.isRequired,visualization:z().object.isRequired,onResponsesReceived:z().func.isRequired,filters:z().object,onColumnHeaderClick:z().func,onError:z().func};const we=()=>{const[e,t]=(0,l.useState)();return(0,l.useEffect)((()=>{n().send(window.top,"getProps").then((e=>t(e.data))).catch((e=>console.error(e)))}),[]),e?l.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},l.createElement(_e,e)):null}}}]);