(self.webpackChunkline_listing_app=self.webpackChunkline_listing_app||[]).push([[2143],{2830:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ze});var n=a(3135),i=a(8594),l=a(4479),r=a(6329),s=a(1006),o=a.n(s),d=a(3665),u=a.n(d),c=a(2085),p=a(1475),g=a(9551),m=a(2703),v=a(8107),f=a(9308),h=a(3554),y=a(5215),S=a(1250),E=a(9647),w=a(1276),_=a(1949),z=a(101),b=a(2305),C=a(6206),V=a.n(C);const D="NORMAL",T={displayDensity:{defaultValue:"NORMAL",requestable:!1,savable:!0},fontSize:{defaultValue:D,requestable:!1,savable:!0},digitGroupSeparator:{defaultValue:"SPACE",requestable:!1,savable:!0},showHierarchy:{defaultValue:!1,requestable:!0,savable:!0}},P=e=>Object.entries(T).filter((e=>e[1].requestable)).reduce(((t,a)=>{let[n,i]=a;return void 0!==e[n]&&e[n]!==i.defaultValue&&(t[n]=e[n]),t}),{});var N=a(5633),k=a(9941),I=a.n(k),R=a(5133);new Set([R.P6,R.qI,R.xi,R.PH,R.M6]),new Set([R.zC]);const L="programStatus",x="eventStatus",A="createdBy",M="lastUpdatedBy",O="eventDate",q="enrollmentDate",Z="incidentDate",U="scheduledDate",F="lastUpdated",W=new Set([O,q,Z,U,F]);var H=a(4805),$=a(1517),j=a(2644);const Q="COMPLETED",G="EVENT",B="ENROLLMENT",X={[H.rx]:"ouname",[L]:"programstatus",[x]:"eventstatus",[A]:"createdbydisplayname",[M]:"lastupdatedbydisplayname",[O]:"eventdate",[q]:"enrollmentdate",[Z]:"incidentdate",[U]:"scheduleddate",[F]:"lastupdated"},K=e=>{let{showHierarchy:t}=e;const a=Object.assign({},X);return t&&(a[H.rx]="ounamehierarchy"),a},Y={[G]:O,[B]:q},J=(e,t)=>{let{outputType:a,type:n}=t;return e.filter((e=>!["longitude","latitude"].includes(e.dimension))).map((e=>e.dimensionType===R.cl?{...e,dimensionType:R.P6}:e.dimension===H.vi&&n===j.UU?{...e,dimension:Y[a],dimensionType:R.KV}:e))},ee=(j.UU,j.Zp,e=>{let{value:t,header:a={},visualization:n={}}=e;return[X.eventStatus,X.programStatus].includes(a.name)?{ACTIVE:v.Z.t("Active"),CANCELLED:v.Z.t("Cancelled"),[Q]:v.Z.t("Completed"),SCHEDULE:v.Z.t("Scheduled")}[t]||t:[p.$d,p.Wt].includes(a.valueType)?t&&I()(t).format(a.name===X.lastUpdated||a.valueType===p.Wt?"yyyy-MM-DD hh:mm":"yyyy-MM-DD"):(null==a?void 0:a.valueType)===p.H?t&&I()(t).format("yyyy-MM-DD"):(0,N.Q)(t,a.valueType||p.kl,a.optionSet?{}:{digitGroupSeparator:n.digitGroupSeparator,skipRounding:!1})}),te=function(){let{stageOffset:e,column:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";if(Number.isInteger(e)){let a;return 0===e?a=v.Z.t("most recent"):1===e?a=v.Z.t("oldest"):e>1?a=v.Z.t("oldest {{repeatEventIndex}}",{repeatEventIndex:"+"+(e-1)}):e<0&&(a=v.Z.t("most recent {{repeatEventIndex}}",{repeatEventIndex:e})),`${t} (${a})`}return t},ae="Visualization_legendKeyScrollbox__xeUwY",ne="Visualization_pluginContainer__oXPo4",ie="Visualization_fetchIndicator__I2E9y",le="Visualization_fetching__7HD9F",re="Visualization_stickyFooter__Dd34A",se="Visualization_footerCell__Fncu5",oe="Visualization_stickyNavigation__0J6KV",de="Visualization_dataTable__5lDA5",ue="Visualization_headerCell__4qkrt",ce="Visualization_dimensionModalHandler__yWmOU",pe="Visualization_fontSizeLarge__z2BH2",ge="Visualization_fontSizeNormal__jf7Sh",me="Visualization_fontSizeSmall__FfsnC",ve="Visualization_sizeComfortable__Su+7Q",fe="Visualization_sizeNormal__gHiph",he="Visualization_sizeCompact__8D9I5",ye="Visualization_cell__6WA8H",Se="Visualization_emptyCell__5ufEQ",Ee="Visualization_nowrap__L4Sfl";var we=a(9458);const _e="NV",ze=()=>({1:v.Z.t("Yes"),0:v.Z.t("No"),[_e]:v.Z.t("Not answered")}),be={[B]:"enrollments",[G]:"events"},Ce=[A,M],Ve=(e,t,a)=>{switch(t.valueType){case p.zU:case p.mb:return ze()[e||_e];default:var n,i;return e?t.optionSet?(null===(i=((e,t)=>Object.values(t).find((t=>t.code===e)))(e,a))||void 0===i?void 0:i.name)||e:(null===(n=a[e])||void 0===n?void 0:n.name)||e:e}},De=e=>{const t={},a=e=>{const a=[];return e.forEach((e=>{const n=e.dimension;var i,l;(e=>W.has(e))(n)||n===x||n===L?null!==(i=e.items)&&void 0!==i&&i.length&&(t[n]=null===(l=e.items)||void 0===l?void 0:l.map((e=>e.id))):Ce.includes(n)||a.push(e)})),a},n=a(e[$.Aq]),i=a(e[$.dQ]),l=a(e[$.lT]),r=K(P(e)),s=[...e[$.Aq],...e[$.dQ]].map((e=>{var t;let{dimension:a,programStage:n,repetition:i}=e;const l=null!=n&&n.id?`${n.id}.${a}`:r[a]||a;return null!=i&&null!==(t=i.indexes)&&void 0!==t&&t.length?i.indexes.map((e=>l.replace(/\./,`[${e}].`))):l}));return{adaptedVisualization:{[$.Aq]:n,[$.dQ]:i,[$.lT]:l},headers:s,parameters:t}},Te=async e=>{let{analyticsEngine:t,visualization:a,pageSize:n,page:i,relativePeriodDate:l,sortField:r,sortDirection:s,displayProperty:o}=e;const{adaptedVisualization:d,headers:u,parameters:c}=De(a);let p=(new t.request).fromVisualization(d).withParameters({headers:u,totalPages:!1,...c}).withProgram(a.program.id).withDisplayProperty(o.toUpperCase()).withOutputType(a.outputType).withPageSize(n).withPage(i).withIncludeMetadataDetails();var g;a.outputType!==B&&(p=p.withStage(null===(g=a.programStage)||void 0===g?void 0:g.id));if(l&&(p=p.withRelativePeriodDate(l)),r)switch(s){case"asc":p=p.withAsc(r);break;case"desc":p=p.withDesc(r)}const m=(v=a.outputType,be[v]);var v;return await t[m].getQuery(p)},Pe={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}},Ne=async e=>{let{legendSetIds:t,dataEngine:a}=e;if(!t.length)return[];const n=await(async e=>{let{dataEngine:t,ids:a}=e;return(await t.query({legendSets:Pe},{variables:{ids:a}})).legendSets.legendSets})({dataEngine:a,ids:t});return n},ke=e=>{let{visualization:t,filters:a,isVisualizationLoading:i,displayProperty:l,onResponsesReceived:r,pageSize:s,page:o,sortField:d,sortDirection:u}=e;const g=(0,n.bQ)(),[v]=(0,c.useState)((()=>we.Z.getAnalytics(g))),f=(0,c.useRef)(!1),[h,y]=(0,c.useState)(!0),[S,E]=(0,c.useState)(!0),[w,_]=(0,c.useState)(void 0),[z,b]=(0,c.useState)(null),C=null==a?void 0:a.relativePeriodDate,V=(0,c.useCallback)((async()=>{try{var e,a,n,i;const c=await Te({analyticsEngine:v,page:o,pageSize:s,relativePeriodDate:C,sortDirection:u,sortField:d,visualization:t,displayProperty:l}),h=(e=>e.headers.map(((t,a)=>{const n={...t,index:a},{dimensionId:i,programStageId:l}=(e=>{const[t,a]=e.split(".").reverse(),[n,i]=(a||"").split("[");return{dimensionId:t,programStageId:n,repetitionIndex:(null==i?void 0:i.length)&&i.substring(0,i.indexOf("]"))}})(t.name);return l&&e.headers.filter((e=>e.name.includes(i))).length>1&&(n.column+=` - ${e.metaData.items[l].name}`),n})))(c),S=((e,t)=>{const a=[];for(let n=0,i=e.rows.length;n<i;n++){const i=e.rows[n],l=[];for(let a=0,n=t.length;a<n;a++){const n=t[a],r=i[n.index];l.push(Ve(r,n,e.metaData.items))}a.push(l)}return a})(c,h),w=c.metaData.pager,z=[],V=h.reduce(((e,t)=>{var a;return{...e,[t.name]:null===(a=c.metaData.items[t.name])||void 0===a?void 0:a.legendSet}}),{});(null===(e=t.legend)||void 0===e?void 0:e.strategy)===m.zv&&null!==(a=t.legend)&&void 0!==a&&null!==(n=a.set)&&void 0!==n&&n.id?z.push(t.legend.set.id):(null===(i=t.legend)||void 0===i?void 0:i.strategy)===m.EE&&Object.values(V).filter((e=>e)).forEach((e=>z.push(e)));const D=await Ne({legendSetIds:z,dataEngine:g});D.length&&h.filter((e=>{return t=e.valueType,[p.FV,p.SA,p.y3,p.$r,p.VX,p.M7,p.iq].includes(t);var t})).forEach((e=>{switch(t.legend.strategy){case m.zv:e.legendSet=D[0];break;case m.EE:e.legendSet=D.find((t=>t.id===V[e.name]))}})),f.current&&_(void 0),f.current&&b({headers:h,rows:S,pager:w}),r(c)}catch(e){f.current&&_(e)}finally{f.current&&y(!1),f.current&&E(!1)}}),[v,o,s,C,u,d,t]);return(0,c.useEffect)((()=>(f.current=!0,()=>{f.current=!1})),[]),(0,c.useEffect)((()=>{E(!0),V()}),[t,o,s,d,u,C]),(0,c.useEffect)((()=>{i&&(E(!1),y(!1),_(void 0),b(null))}),[i]),{loading:h,fetching:S,error:w,data:z,isGlobalLoading:i}},Ie=e=>{let{offline:t,...a}=e;return t?c.createElement(f.u,{content:v.Z.t("Not available offline")},c.createElement(h.t,a)):c.createElement(h.t,a)};Ie.propTypes={offline:u().bool};const Re=e=>{let{filters:t,visualization:a,isVisualizationLoading:i,displayProperty:l,onResponsesReceived:r,onColumnHeaderClick:s,onError:o}=e;const[d,u]=(0,c.useState)([]),[{sortField:f,sortDirection:h,pageSize:C,page:D},T]=(0,c.useReducer)(((e,t)=>({...e,...t})),{sortField:null,sortDirection:"asc",page:1,pageSize:100}),N=(0,c.useMemo)((()=>a&&(e=>{const t=J(e[$.Aq],e),a=J(e[$.dQ],e),n=J(e[$.lT],e);e.completedOnly&&e.outputType===G&&n.push({dimension:x,items:[{id:Q}]});const i={...e};return delete i.completedOnly,{...i,[$.Aq]:t,[$.dQ]:a,[$.lT]:n}})(a)),[a]),k=(0,c.useRef)(N),I=(0,c.useCallback)((e=>T({page:e})),[]),{isDisconnected:R}=(0,n.Uw)(),{headers:L}=De(N);L&&f&&(L.includes(f)||T({sortField:null,sortDirection:"asc"}));const{fetching:A,error:M,data:O}=ke({filters:t,visualization:N,isVisualizationLoading:i,displayProperty:l,onResponsesReceived:r,pageSize:C,page:N!==k.current?1:D,sortField:f,sortDirection:h});if((0,c.useEffect)((()=>{k.current=N,I(1)}),[N,I]),(0,c.useEffect)((()=>{if(O&&N){var e;const t=O.headers.filter((e=>e.legendSet)).map((e=>e.legendSet)),a=t.filter(((e,a)=>{var n;return t.findIndex((t=>t.id===e.id))===a&&(null===(n=e.legends)||void 0===n?void 0:n.length)}));a.length&&null!==(e=N.legend)&&void 0!==e&&e.showKey?u(a):u([])}else u([])}),[O,N]),(0,c.useEffect)((()=>{M&&o&&o(M)}),[M,o]),!O||M)return null;const q=(e=>{switch(e){case"COMFORTABLE":return ve;case"COMPACT":return he;default:return fe}})(N.displayDensity),Z=(e=>{switch(e){case"LARGE":return pe;case"SMALL":return me;default:return ge}})(N.fontSize),U=String(Math.max(O.headers.length,1)),F=e=>{let{name:t,direction:a}=e;return T({sortField:t,sortDirection:a,page:1})},W=K(P(N)),H=e=>{const t=te(e),a=Number.isInteger(e.stageOffset)?e.name.replace(/\[-?\d+\]/,""):e.name;return c.createElement("span",{className:V()(ue,ce),onClick:s?()=>s((e=>Object.keys(W).find((t=>W[t]===e)))(a)||a):void 0},t)},j=!(null==t||!t.relativePeriodDate);return c.createElement("div",{className:ne},c.createElement("div",{"data-test":"line-list-loading-indicator",className:V()(ie,{[le]:A})},c.createElement(y.w,{scrollHeight:j?"calc(100vh - 285px)":"100%",scrollWidth:"100%",width:"auto",className:de,dataTest:"line-list-table"},c.createElement(S.s,null,c.createElement(E.U,null,O.headers.map(((e,t)=>e?c.createElement(w.p,{fixed:!0,top:"0",key:e.name,name:e.name,onSortIconClick:F,sortDirection:R?void 0:e.name===f?h:"default",sortIconTitle:v.Z.t("Sort by {{column}}",{column:te(e)}),className:V()(ue,Z,q,"bordered"),dataTest:"table-header"},H(e)):c.createElement(w.p,{fixed:!0,top:"0",key:`undefined_${t}`,className:V()(ue,Z,q),dataTest:"table-header"}))))),c.createElement(_.R,{dataTest:"table-body"},O.rows.map(((e,t)=>c.createElement(E.U,{key:t,dataTest:"table-row"},e.map(((e,t)=>{var a,n,i;return c.createElement(z.W,{key:t,className:V()(ye,Z,q,{[Se]:!e,[Ee]:(i=O.headers[t],[p.FV,p.$r,p.VX,p.M7,p.iq,p.y3,p.SA,p.zf,p.$d,p.Wt,p.so].includes(i.valueType)&&!i.optionSet)},"bordered"),backgroundColor:(null===(a=N.legend)||void 0===a?void 0:a.style)===m.UJ?(0,m.i3)(O.headers[t].legendSet,e):void 0,dataTest:"table-cell"},c.createElement("div",{style:(null===(n=N.legend)||void 0===n?void 0:n.style)===m.Xr?{color:(0,m.i3)(O.headers[t].legendSet,e)}:{}},((e,t)=>(null==t?void 0:t.valueType)===p.Xw?c.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},e):ee({value:e,header:t,visualization:N}))(e,O.headers[t])))})))))),c.createElement(b.j,{className:re},c.createElement(E.U,null,c.createElement(z.W,{colSpan:U,staticStyle:!0,className:se},c.createElement("div",{className:V()(oe,q)},c.createElement(Ie,{offline:R,disabled:R||A,page:O.pager.page,pageSize:O.pager.pageSize||100,isLastPage:O.pager.isLastPage,onPageChange:I,onPageSizeChange:e=>T({pageSize:e,page:1}),pageSizeSelectText:v.Z.t("Rows per page"),pageLength:O.rows.length,pageSummaryText:e=>{let{firstItem:t,lastItem:a,page:n}=e;return v.Z.t("Page {{page}}, row {{firstItem}}-{{lastItem}}",{firstItem:t,lastItem:a,page:n})}}))))))),Boolean(d.length)&&c.createElement("div",{className:ae,"data-test":"visualization-legend-key"},c.createElement(g.Z,{legendSets:d})))};Re.defaultProps={displayProperty:"name",isVisualizationLoading:!1,onResponsesReceived:Function.prototype},Re.propTypes={displayProperty:u().string.isRequired,isVisualizationLoading:u().bool.isRequired,visualization:u().object.isRequired,onResponsesReceived:u().func.isRequired,filters:u().object,onColumnHeaderClick:u().func,onError:u().func};const Le="READY",xe="INSTALLING";function Ae(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(Le)}}const Me=()=>c.createElement(i.m,null,c.createElement(l.M,null,c.createElement(r.V,null))),Oe=e=>{let{id:t,children:a,cacheNow:i,isParentCached:l}=e;const{startRecording:r,isCached:s,remove:d}=(0,n.Of)(t);return(0,c.useEffect)((()=>{i&&r({onError:console.error})}),[i]),(0,c.useEffect)((()=>{const e=o().on("removeCachedData",{window:window.parent},(()=>d()));return()=>e.cancel()}),[d]),(0,c.useEffect)((()=>{!l&&s&&d()}),[l]),c.createElement(n.MW,{id:t,loadingMask:Me},a)};Oe.propTypes={cacheNow:u().bool,children:u().node,id:u().string,isParentCached:u().bool};const qe=e=>{o().send(window.parent,"installationStatus",{installationStatus:e})},Ze=()=>{const[e,t]=(0,c.useState)(),a=e=>t(e.data);return(0,c.useEffect)((()=>{o().send(window.parent,"getProps").then(a).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?Le:a.installing?(Ae({installingWorker:a.installing,onStateChange:t}),xe):(a.onupdatefound=()=>{t(xe);const e=a.installing;e&&Ae({installingWorker:e,onStateChange:t})},null):null}({onStateChange:qe}).then(qe);const e=o().on("newProps",{window:window.parent},a);return()=>e.cancel()}),[]),e?c.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},c.createElement(Oe,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},c.createElement(Re,e))):null}},2480:()=>{}}]);